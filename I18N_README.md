# Система интернационализации (i18n) - Обновленная версия

## Обзор

В проект добавлена система интернационализации, поддерживающая русский и английский языки. По умолчанию установлен английский язык. Система полностью переписана для использования внешних JSON файлов.

## Возможности

- ✅ Поддержка русского и английского языков
- ✅ Переключатель языка в интерфейсе
- ✅ Сохранение выбранного языка в localStorage
- ✅ Автоматическое обновление всего интерфейса при смене языка
- ✅ Интернационализация всех текстов приложения
- ✅ Поддержка параметризованных переводов
- ✅ Интернационализация задач (заголовки, описания, подсказки)
- ✅ **НОВОЕ**: Отдельные JSON файлы для каждого языка
- ✅ **НОВОЕ**: Динамическая загрузка переводов с сервера
- ✅ **НОВОЕ**: Автоматизированные тесты для проверки i18n

## Структура файлов

### Основные файлы
- `i18n.js` - Основной класс системы интернационализации
- `i18n/i18nen.json` - Английские переводы
- `i18n/i18nru.json` - Русские переводы

### Тестирование
- `tests/i18n/i18n-test.js` - Полный набор тестов для браузера
- `tests/i18n/test-runner.html` - Веб-интерфейс для запуска тестов
- `tests/i18n/run-tests-simple.js` - Простые тесты для командной строки

### Интернационализированные файлы задач
- `sql-tasks/basic_select.json` - Базовая выборка данных
- `sql-tasks/aggregation.json` - Агрегация данных
- `sql-tasks/join_tables.json` - Соединение таблиц

## Использование

### Добавление переводов

#### Добавление в JSON файлы (рекомендуется)
```json
// В файл i18n/i18nen.json
{
  "новая": {
    "секция": {
      "ключ": "English text"
    }
  }
}

// В файл i18n/i18nru.json  
{
  "новая": {
    "секция": {
      "ключ": "Русский текст"
    }
  }
}
```

### Использование в HTML
```html
<!-- Для текстового содержимого -->
<h1 data-i18n="header.title">Browser SQL Trainer</h1>

<!-- Для placeholder -->
<input data-i18n-placeholder="sql.placeholder" placeholder="Enter your SQL query here...">
```

### Использование в JavaScript
```javascript
// Простой перевод
const text = i18n.t('error.loading');

// Перевод с параметрами
const text = i18n.t('task.wrong_rows', {expected: 5, actual: 3});

// Переключение языка
i18n.setLanguage('ru');
```

### Структура задач
```json
{
  "title": {
    "en": "English Title",
    "ru": "Русский заголовок"
  },
  "description": {
    "en": "English description",
    "ru": "Русское описание"
  },
  "hint": {
    "en": "English hint",
    "ru": "Русская подсказка"
  }
}
```

## Поддерживаемые языки

- **en** - English (по умолчанию)
- **ru** - Русский

## Переключение языка

Пользователь может переключать язык через селектор в правом верхнем углу интерфейса. Выбранный язык сохраняется в localStorage и восстанавливается при следующем посещении.

## Примеры ключей переводов

### Интерфейс
- `header.title` - Заголовок приложения
- `header.subtitle` - Подзаголовок
- `section.current_task` - Заголовок секции "Текущая задача"
- `section.database_schema` - Заголовок секции "Схема базы данных"
- `section.sql_editor` - Заголовок секции "SQL редактор"
- `section.results` - Заголовок секции "Результаты"

### Задачи
- `task.next_task` - Кнопка "Следующая задача"
- `task.hint_label` - Метка "Подсказка:"
- `task.show_hint` - Кнопка "Показать подсказку"
- `task.hide_hint` - Кнопка "Скрыть подсказку"
- `task.correct` - Сообщение об успешном решении

### Ошибки
- `error.loading` - Ошибка загрузки SQLite
- `error.no_tasks` - Нет доступных задач
- `error.sql_execution` - Ошибка выполнения SQL

### SQL редактор
- `sql.placeholder` - Placeholder для ввода SQL
- `sql.execute` - Кнопка "Выполнить запрос"
- `sql.executing` - Состояние "Выполняется..."

## Тестирование

### Веб-интерфейс тестов
Откройте `http://localhost:8000/tests/i18n/test-runner.html` в браузере для запуска полного набора тестов с визуальным интерфейсом.

### Командная строка
```bash
# Запуск простых тестов для проверки JSON файлов
cd tests/i18n
node run-tests-simple.js
```

### Что тестируется
- ✅ Загрузка переводов из JSON файлов
- ✅ Преобразование вложенной структуры в плоскую
- ✅ Получение переводов для разных языков
- ✅ Параметризованные переводы  
- ✅ Переключение языков
- ✅ Проверка целостности переводов
- ✅ Сравнение количества ключей между языками
- ✅ Проверка важных ключей переводов

## Архитектура системы

### Класс I18n
```javascript
class I18n {
    constructor()              // Инициализация, загрузка сохраненного языка
    loadTranslations(lang)     // Асинхронная загрузка переводов
    fetchTranslations(lang)    // Получение переводов с сервера
    flattenTranslations(obj)   // Преобразование вложенной структуры
    t(key, params)            // Получение перевода с параметрами
    setLanguage(lang)         // Переключение языка
    updateUI()                // Обновление интерфейса
}
```

### Формат JSON файлов
```json
{
  "section": {
    "subsection": {
      "key": "Translation text"
    }
  }
}
```

Преобразуется в плоские ключи: `section.subsection.key`